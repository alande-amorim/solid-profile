{"id":"node_modules/@inrupt/solid-client-authn-core/dist/util/validateSchema.js","dependencies":[{"name":"/Users/amorim.alande/Projects/pod-profile/node_modules/@inrupt/solid-client-authn-core/dist/util/validateSchema.js.map","includedInParent":true,"mtime":1611945169047},{"name":"/Users/amorim.alande/Projects/pod-profile/node_modules/@inrupt/solid-client-authn-core/src/util/validateSchema.ts","includedInParent":true,"mtime":1611945169047},{"name":"/Users/amorim.alande/Projects/pod-profile/package.json","includedInParent":true,"mtime":1612372540913},{"name":"/Users/amorim.alande/Projects/pod-profile/node_modules/@inrupt/solid-client-authn-core/package.json","includedInParent":true,"mtime":1611945169047},{"name":"ajv","loc":{"line":7,"column":38},"parent":"/Users/amorim.alande/Projects/pod-profile/node_modules/@inrupt/solid-client-authn-core/dist/util/validateSchema.js","resolved":"/Users/amorim.alande/Projects/pod-profile/node_modules/ajv/lib/ajv.js"},{"name":"lodash.clonedeep","loc":{"line":8,"column":51},"parent":"/Users/amorim.alande/Projects/pod-profile/node_modules/@inrupt/solid-client-authn-core/dist/util/validateSchema.js","resolved":"/Users/amorim.alande/Projects/pod-profile/node_modules/lodash.clonedeep/index.js"},{"name":"../errors/InruptError","loc":{"line":9,"column":46},"parent":"/Users/amorim.alande/Projects/pod-profile/node_modules/@inrupt/solid-client-authn-core/dist/util/validateSchema.js","resolved":"/Users/amorim.alande/Projects/pod-profile/node_modules/@inrupt/solid-client-authn-core/dist/errors/InruptError.js"}],"generated":{"js":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.traverseObject = exports.compileJoinedStringOf = exports.compileTypeof = void 0;\nconst ajv_1 = __importDefault(require(\"ajv\"));\nconst lodash_clonedeep_1 = __importDefault(require(\"lodash.clonedeep\"));\nconst InruptError_1 = __importDefault(require(\"../errors/InruptError\"));\nfunction compileTypeof(type) {\n    return (data) => {\n        return typeof data === type;\n    };\n}\nexports.compileTypeof = compileTypeof;\nfunction compileJoinedStringOf(strings) {\n    return (data) => {\n        return !data.split(\" \").some((value) => strings.indexOf(value) === -1);\n    };\n}\nexports.compileJoinedStringOf = compileJoinedStringOf;\nfunction traverseObject(data, schema, parent, parentKey) {\n    if (schema.type === \"object\") {\n        Object.keys(data).forEach((key) => {\n            if (schema.properties && schema.properties[key]) {\n                traverseObject(data[key], schema.properties[key], data, key);\n            }\n        });\n    }\n    else if (schema.type === \"array\") {\n        data.forEach((item, index) => {\n            if (schema.items) {\n                traverseObject(item, schema.items, data, index);\n            }\n        });\n    }\n    else if (schema.shouldConvertToUrl && parent && parentKey) {\n        parent[parentKey] = data;\n    }\n}\nexports.traverseObject = traverseObject;\nfunction validateSchema(schema, inputItem) {\n    const item = lodash_clonedeep_1.default(inputItem);\n    const ajv = new ajv_1.default();\n    ajv.addKeyword(\"typeof\", {\n        compile: compileTypeof,\n    });\n    ajv.addKeyword(\"joinedStringOf\", {\n        compile: compileJoinedStringOf,\n    });\n    if (!ajv.validate(schema, item)) {\n        let message = `${schema.title ? schema.title : \"schema\"} is invalid`;\n        if (ajv.errors) {\n            message += \":\";\n            message += ajv.errors\n                .map((err) => `\\n${err.dataPath} ${err.message}`)\n                .toString();\n        }\n        throw new InruptError_1.default(message);\n    }\n    traverseObject(item, schema);\n    return item;\n}\nexports.default = validateSchema;\n"},"sourceMaps":{"js":{"version":3,"file":"validateSchema.js","sourceRoot":"","sources":["../../src/util/validateSchema.ts"],"names":[],"mappings":";;;;;;AA6BA,8CAAsB;AACtB,wEAAyC;AACzC,wEAAgD;AAQhD,SAAgB,aAAa,CAAC,IAAY;IACxC,OAAO,CAAC,IAAS,EAAW,EAAE;QAC5B,OAAO,OAAO,IAAI,KAAK,IAAI,CAAC;IAC9B,CAAC,CAAC;AACJ,CAAC;AAJD,sCAIC;AAKD,SAAgB,qBAAqB,CAAC,OAAiB;IACrD,OAAO,CAAC,IAAY,EAAW,EAAE;QAC/B,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IACzE,CAAC,CAAC;AACJ,CAAC;AAJD,sDAIC;AAKD,SAAgB,cAAc,CAC5B,IAAS,EACT,MAAW,EACX,MAAY,EACZ,SAAe;IAEf,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE;QAC5B,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,GAAW,EAAE,EAAE;YACxC,IAAI,MAAM,CAAC,UAAU,IAAI,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE;gBAC/C,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;aAC9D;QACH,CAAC,CAAC,CAAC;KACJ;SAAM,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,EAAE;QAClC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAS,EAAE,KAAa,EAAE,EAAE;YACxC,IAAI,MAAM,CAAC,KAAK,EAAE;gBAChB,cAAc,CAAC,IAAI,EAAE,MAAM,CAAC,KAAK,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;aACjD;QACH,CAAC,CAAC,CAAC;KACJ;SAAM,IAAI,MAAM,CAAC,kBAAkB,IAAI,MAAM,IAAI,SAAS,EAAE;QAK3D,MAAM,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC;KAC1B;AACH,CAAC;AAzBD,wCAyBC;AASD,SAAwB,cAAc,CACpC,MAA8C,EAC9C,SAAc;IAGd,MAAM,IAAI,GAAG,0BAAS,CAAC,SAAS,CAAC,CAAC;IAClC,MAAM,GAAG,GAAG,IAAI,aAAG,EAAE,CAAC;IAEtB,GAAG,CAAC,UAAU,CAAC,QAAQ,EAAE;QACvB,OAAO,EAAE,aAAa;KACvB,CAAC,CAAC;IACH,GAAG,CAAC,UAAU,CAAC,gBAAgB,EAAE;QAC/B,OAAO,EAAE,qBAAqB;KAC/B,CAAC,CAAC;IAEH,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,MAAM,EAAE,IAAI,CAAC,EAAE;QAC/B,IAAI,OAAO,GAAG,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,QAAQ,aAAa,CAAC;QAGrE,IAAI,GAAG,CAAC,MAAM,EAAE;YACd,OAAO,IAAI,GAAG,CAAC;YACf,OAAO,IAAI,GAAG,CAAC,MAAM;iBAClB,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,KAAK,GAAG,CAAC,QAAQ,IAAI,GAAG,CAAC,OAAO,EAAE,CAAC;iBAChD,QAAQ,EAAE,CAAC;SACf;QAED,MAAM,IAAI,qBAAW,CAAC,OAAO,CAAC,CAAC;KAChC;IAGD,cAAc,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;IAE7B,OAAO,IAAI,CAAC;AACd,CAAC;AAjCD,iCAiCC","sourcesContent":["/*\n * Copyright 2021 Inrupt Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * @hidden\n * @packageDocumentation\n */\n\n/**\n * A wrapper function for AJV schema validation\n */\nimport Ajv from \"ajv\";\nimport cloneDeep from \"lodash.clonedeep\";\nimport InruptError from \"../errors/InruptError\";\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\n\n/**\n * @hidden\n */\nexport function compileTypeof(type: string) {\n  return (data: any): boolean => {\n    return typeof data === type; // eslint-disable-line valid-typeof\n  };\n}\n\n/**\n * @hidden\n */\nexport function compileJoinedStringOf(strings: string[]) {\n  return (data: string): boolean => {\n    return !data.split(\" \").some((value) => strings.indexOf(value) === -1);\n  };\n}\n\n/**\n * @hidden\n */\nexport function traverseObject(\n  data: any,\n  schema: any,\n  parent?: any,\n  parentKey?: any\n): void {\n  if (schema.type === \"object\") {\n    Object.keys(data).forEach((key: string) => {\n      if (schema.properties && schema.properties[key]) {\n        traverseObject(data[key], schema.properties[key], data, key);\n      }\n    });\n  } else if (schema.type === \"array\") {\n    data.forEach((item: any, index: number) => {\n      if (schema.items) {\n        traverseObject(item, schema.items, data, index);\n      }\n    });\n  } else if (schema.shouldConvertToUrl && parent && parentKey) {\n    // Set custom rules here\n    // Convert to URL\n    // TODO: Fix this properly\n    // eslint-disable-next-line no-param-reassign\n    parent[parentKey] = data;\n  }\n}\n/* eslint-enable @typescript-eslint/no-explicit-any */\n\n/**\n * Validates a given item and given schema. Throws and error if invalid\n * @param schema The schema to validate against\n * @param item The item to validate\n */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport default function validateSchema(\n  schema: { title?: string; [key: string]: any },\n  inputItem: any\n): any {\n  /* eslint-enable @typescript-eslint/no-explicit-any */\n  const item = cloneDeep(inputItem);\n  const ajv = new Ajv();\n\n  ajv.addKeyword(\"typeof\", {\n    compile: compileTypeof,\n  });\n  ajv.addKeyword(\"joinedStringOf\", {\n    compile: compileJoinedStringOf,\n  });\n\n  if (!ajv.validate(schema, item)) {\n    let message = `${schema.title ? schema.title : \"schema\"} is invalid`;\n    // istanbul ignore else: AJV's docs say this should always be set when validation fails,\n    //                       so we cannot test it.\n    if (ajv.errors) {\n      message += \":\";\n      message += ajv.errors\n        .map((err) => `\\n${err.dataPath} ${err.message}`)\n        .toString();\n    }\n\n    throw new InruptError(message);\n  }\n\n  // If all is true, apply modifications\n  traverseObject(item, schema);\n\n  return item;\n}\n"]}},"error":null,"hash":"797a61ec012aafd6ab0ab30d21dc7f1c","cacheData":{"env":{}}}